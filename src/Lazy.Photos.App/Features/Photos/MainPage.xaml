<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:Lazy.Photos.App.Features.Photos"
             x:Class="Lazy.Photos.App.Features.Photos.MainPage"
             Title="Photos"
             BackgroundColor="#1F1F1F">

    <Grid RowDefinitions="Auto,*">
        <Label Grid.Row="0"
               Padding="12,8"
               Text="{Binding ErrorMessage}"
               TextColor="#CF6679"
               BackgroundColor="#2D2D2D"
               IsVisible="{Binding HasError}" />

        <RefreshView Grid.Row="1"
                     IsRefreshing="{Binding IsBusy}"
                     Command="{Binding RefreshCommand}"
                     RefreshColor="White">
            <CollectionView x:Name="PhotosCollection"
                            ItemsSource="{Binding PhotoSections}"
                            IsGrouped="True"
                            ItemSizingStrategy="MeasureAllItems"
                            ItemsUpdatingScrollMode="KeepScrollOffset"
                            SelectionMode="None"
                            BackgroundColor="Transparent"
                            Margin="0">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="{Binding Columns}"
                                     HorizontalItemSpacing="2"
                                     VerticalItemSpacing="2" />
                </CollectionView.ItemsLayout>
                <CollectionView.GroupHeaderTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="*,Auto"
                              Padding="16,16,16,8"
                              BackgroundColor="#1F1F1F">
                            <StackLayout Grid.Column="0"
                                         Spacing="2">
                                <Label Text="{Binding Title}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="White" />
                                <Label Text="{Binding Location}"
                                       FontSize="13"
                                       TextColor="#AAAAAA"
                                       IsVisible="{Binding Location, Converter={StaticResource IsNotNullConverter}}" />
                            </StackLayout>
                            <Button Grid.Column="1"
                                    Text="..."
                                    FontSize="20"
                                    TextColor="#AAAAAA"
                                    BackgroundColor="Transparent"
                                    VerticalOptions="Start"
                                    Padding="8,0"
                                    HeightRequest="32"
                                    WidthRequest="40" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.GroupHeaderTemplate>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid BackgroundColor="#2D2D2D">
                            <Image Source="{Binding Thumbnail}"
                                   Aspect="AspectFill"
                                   WidthRequest="{Binding BindingContext.CellSize, Source={RelativeSource AncestorType={x:Type local:MainPage}}}"
                                   HeightRequest="{Binding BindingContext.CellSize, Source={RelativeSource AncestorType={x:Type local:MainPage}}}" />
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding BindingContext.OpenPhotoCommand, Source={RelativeSource AncestorType={x:Type local:MainPage}}}"
                                                      CommandParameter="{Binding .}" />
                            </Grid.GestureRecognizers>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <Label Text="No photos found on this device."
                           Padding="12"
                           TextColor="#AAAAAA"
                           HorizontalTextAlignment="Center"
                           VerticalTextAlignment="Center" />
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>

        <Grid Grid.Row="1"
              BackgroundColor="#CC000000"
              IsVisible="{Binding IsInitializing}"
              InputTransparent="False">
            <ActivityIndicator IsRunning="True"
                               IsVisible="True"
                               Color="White"
                               WidthRequest="48"
                               HeightRequest="48"
                               VerticalOptions="Center"
                               HorizontalOptions="Center" />
        </Grid>
    </Grid>

</ContentPage>
