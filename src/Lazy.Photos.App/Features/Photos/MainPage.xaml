<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:Lazy.Photos.App.Features.Photos"
             x:Class="Lazy.Photos.App.Features.Photos.MainPage"
             Title="Photos"
             BackgroundColor="White">

    <Grid RowDefinitions="Auto,*">
        <Label Grid.Row="0"
               Padding="12,8"
               Text="{Binding ErrorMessage}"
               TextColor="#B00020"
               IsVisible="{Binding HasError}" />

        <RefreshView Grid.Row="1"
                     IsRefreshing="{Binding IsBusy}"
                     Command="{Binding RefreshCommand}">
            <CollectionView ItemsSource="{Binding PhotoSections}"
                            IsGrouped="True"
                            SelectionMode="None"
                            Margin="12,8">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="{Binding Columns}"
                                     HorizontalItemSpacing="2"
                                     VerticalItemSpacing="2" />
                </CollectionView.ItemsLayout>
                <CollectionView.GroupHeaderTemplate>
                    <DataTemplate>
                        <Label Text="{Binding Title}"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="#111"
                               Margin="0,12,0,6" />
                    </DataTemplate>
                </CollectionView.GroupHeaderTemplate>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Image Source="{Binding Thumbnail}"
                                   Aspect="AspectFill"
                                   HeightRequest="{Binding BindingContext.CellSize, Source={RelativeSource AncestorType={x:Type local:MainPage}}}"
                                   WidthRequest="{Binding BindingContext.CellSize, Source={RelativeSource AncestorType={x:Type local:MainPage}}}" />
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding BindingContext.OpenPhotoCommand, Source={RelativeSource AncestorType={x:Type local:MainPage}}}"
                                                      CommandParameter="{Binding .}" />
                            </Grid.GestureRecognizers>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <Label Text="No photos found on this device."
                           Padding="12"
                           HorizontalTextAlignment="Center"
                           VerticalTextAlignment="Center" />
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>
    </Grid>

</ContentPage>
